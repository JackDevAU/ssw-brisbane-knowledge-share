---
interface Props {
    videoUrl: string;
}

const { videoUrl } = Astro.props;

function getEmbedUrl(url: string): string {
    try {
        const urlObj = new URL(url);
        const path = urlObj.pathname;
        const uniqueId = path.split('/').pop()?.split('.')[0];
        
        if (!uniqueId) return '';

        const baseUrl = 'https://sswcom-my.sharepoint.com/personal/samwagner_ssw_com_au/_layouts/15/embed.aspx';
        const embedParams = {
            UniqueId: uniqueId,
            embed: JSON.stringify({
                ust: true,
                hv: 'CopyEmbedCode'
            }),
            referrer: 'StreamWebApp',
            referrerScenario: 'EmbedDialog.Create'
        };

        const searchParams = new URLSearchParams(embedParams);
        return `${baseUrl}?${searchParams.toString()}`;
    } catch {
        return '';
    }
}

const embedUrl = getEmbedUrl(videoUrl);
---

<div class="video-wrapper">
    <div class="video-container">
        {embedUrl && (
            <iframe
                src={embedUrl}
                width="100%"
                height="100%"
                frameborder="0"
                scrolling="no"
                allowfullscreen
                title="Knowledge Sharing Video"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            ></iframe>
        )}
        {!embedUrl && (
            <div class="video-placeholder">
                <p class="text-lg font-semibold">Video not available</p>
                <p class="text-sm text-gray-500 mt-2">Please ensure you're logged into SharePoint to view this content</p>
                <a 
                    href={videoUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="mt-4 inline-flex items-center px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors"
                >
                    Open in SharePoint
                </a>
            </div>
        )}
    </div>
</div>

<style>
    .video-wrapper {
        @apply max-w-[800px] mx-auto mb-8;
    }

    .video-container {
        @apply relative w-full pt-[56.25%] bg-gray-100 rounded-lg overflow-hidden shadow-lg;
    }

    .video-placeholder {
        @apply absolute inset-0 flex flex-col items-center justify-center text-gray-600 bg-gray-50;
    }

    iframe {
        @apply absolute inset-0 w-full h-full border-0;
    }
</style>
</boltArtifact>
