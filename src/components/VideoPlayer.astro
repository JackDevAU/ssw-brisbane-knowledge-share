---
interface Props {
    videoUrl: string;
}

const { videoUrl } = Astro.props;

// Function to convert SharePoint URL to embed URL
function getEmbedUrl(url: string): string {
    if (!url.includes('sharepoint.com')) return url;
    
    // Extract the unique ID from the URL
    const uniqueIdMatch = url.match(/UniqueId=([^&]+)/);
    if (!uniqueIdMatch) return url;
    
    const baseUrl = url.split('personal')[0] + 'personal';
    const uniqueId = uniqueIdMatch[1];
    
    return `${baseUrl}/samwagner_ssw_com_au/_layouts/15/embed.aspx?UniqueId=${uniqueId}&embed={"ust":true,"hv":"CopyEmbedCode"}&referrer=StreamWebApp&referrerScenario=EmbedDialog.Create`;
}

const embedUrl = getEmbedUrl(videoUrl);
---

<div class="video-container">
    {videoUrl ? (
        <iframe
            src={embedUrl}
            width="640"
            height="360"
            frameborder="0"
            scrolling="no"
            allowfullscreen
            title="SharePoint video player"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        ></iframe>
    ) : (
        <div class="flex items-center justify-center h-full bg-gray-100">
            <p class="text-gray-600">Video not available</p>
        </div>
    )}
</div>

<style>
    .video-container {
        @apply relative w-full pt-[56.25%] bg-gray-100 rounded-lg overflow-hidden shadow-lg mb-8;
    }

    iframe {
        @apply absolute top-0 left-0 w-full h-full border-0;
    }
</style>