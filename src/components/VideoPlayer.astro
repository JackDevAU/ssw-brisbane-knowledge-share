---
interface Props {
    videoUrl: string;
}

const { videoUrl } = Astro.props;

function getEmbedUrl(url: string): string {
    try {
        const urlObj = new URL(url);
        const path = urlObj.pathname;
        const uniqueId = path.split('/').pop()?.split('.')[0];
        
        if (!uniqueId) return '';

        const baseUrl = 'https://sswcom-my.sharepoint.com/personal/samwagner_ssw_com_au/_layouts/15/embed.aspx';
        const embedParams = {
            UniqueId: uniqueId,
            embed: JSON.stringify({
                ust: true,
                hv: 'CopyEmbedCode'
            }),
            referrer: 'StreamWebApp',
            referrerScenario: 'EmbedDialog.Create'
        };

        const searchParams = new URLSearchParams(embedParams);
        return `${baseUrl}?${searchParams.toString()}`;
    } catch {
        return '';
    }
}

const embedUrl = getEmbedUrl(videoUrl);
---

<div class="max-w-3xl mx-auto mb-8">
    <div class="relative w-full bg-gray-100 rounded-lg shadow-lg overflow-hidden pb-[56.25%]">
        {embedUrl ? (
            <iframe
                src={embedUrl}
                class="absolute top-0 left-0 w-full h-full border-0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                sandbox="allow-scripts allow-same-origin allow-presentation allow-popups"
                title="Knowledge Sharing Video"
            ></iframe>
        ) : (
            <div class="absolute inset-0 flex flex-col items-center justify-center bg-gray-50 text-gray-600">
                <a
                    href={videoUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="flex flex-col items-center justify-center bg-black text-white rounded-full w-16 h-16 hover:bg-gray-800 transition duration-300"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        fill="currentColor"
                        viewBox="0 0 16 16"
                        class="w-6 h-6"
                    >
                        <path d="M4.5 3.5v9l7-4.5-7-4.5z" />
                    </svg>
                </a>
                <p class="mt-2 text-sm">Watch on SharePoint</p>
            </div>
        )}
    </div>
</div>
